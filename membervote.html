<html>
<head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
    <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- fonts -->
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,300' rel='stylesheet' type='text/css'>

    <link rel="stylesheet" type="text/css" href="pages.css">
  	<title>Past voting stances</title>
</head>
<body onload = "pageopen ()">
<!-- This is for the navbar -->
  <nav class="navbar navbar-inverse">
  <div class="container-fluid">
    <div class="navbar-header">
      <a class="navbar-brand" href="index.html">Politicious</a>
    </div>
    <ul class="nav navbar-nav">
      <li><a href="index.html">Home</a></li>
      <li class="active"><a href="newcongressapi.html">Congress</a></li>
      <li><a href="newdatesanddeadlines.html">Important Dates</a></li> 
      <li><a href="bills.html">Bills</a></li>
      <li><a href="upcomingevents.html">Upcoming Events</a></li>
      <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Voters
        <span class="caret"></span></button>
        <ul class="dropdown-menu">
          <li><a href="young.html">Young voters</a></li>
          <li><a href="votinglaws.html">Voting information</a></li>
        </ul>
      <li><a href="howto.html">Contacting Politicians</a></li>  
      </div>
    </ul>
    <!-- <ul class="nav navbar-nav navbar-right">
      <li><a href="#"><span class="glyphicon glyphicon-user"></span> Sign Up</a></li>
      <li><a href="#"><span class="glyphicon glyphicon-log-in"></span> Login</a></li>
    </ul> -->
  </div>
</nav>
<!-- End of nav bar -->

<p id="representative"></p>
<p id="voting"></p>

	<script>
  var id = window.location.href.split("member_id=")[1]

	function pageopen () {
    basicinfo ();

    	var xhr = new XMLHttpRequest();
    	xhr.open("GET", "http://api.nytimes.com/svc/politics/v3/us/legislative/congress/members/" + id + "/votes.json?apikey=203f43277b8b4d5e8f2f65180fead182", false);
    	xhr.send();

    	console.log(xhr.status);
    	console.log(xhr.statusText);

   		var stanceinfo = xhr.response
   		var splice = stanceinfo.split('"bill":')
   		var text = ""
      text += "Past voting stances" + "<br><br>"
   		//individual bill info
   		for (var x = 1; x < splice.length - 1; x++) {
            var spliceBill = splice[x].split('":');
            var title = spliceBill[3].substring(2,spliceBill[3].indexOf('",'));
         	  var latest_action = spliceBill[4].substring(2, spliceBill[4].indexOf(' }'))
            var date = spliceBill[7].substring(2, spliceBill[7].indexOf(','))
            var position = spliceBill[9].substring(2, spliceBill[9].indexOf(' }'))
            if (spliceBill.length == 15){
            	text += "Title: " + title + "<br>"
            	text += "Latest action: " + latest_action + "<br>"
              text += "Date: " + date + "<br>"
              text += "Position: " + position + "<br>"
            	text += "<br><br>"
            } 
        }
        var stance = document.getElementById("voting");
        stance.innerHTML = text;
}

  function basicinfo () {
    var xhr = new XMLHttpRequest();
        xhr.open("GET", "https://congress.api.sunlightfoundation.com/legislators?bioguide_id=" + id + "&apikey=6a668fb807334bbca5fee69cad4b1d96", false);
        xhr.send();
        console.log(xhr.status);
        console.log(xhr.statusText);
        var congressRepinfo = xhr.response
        var splice = congressRepinfo.split('{"')
        var text = ""
        // individual rep info
        for (var x = 2; x < splice.length - 1; x++) {
            var spliceRep = splice[x].split(':"');
            var chamber = spliceRep[3].substring(0,spliceRep[3].indexOf('"'));
            var website = spliceRep[4].substring(0,spliceRep[4].indexOf('"'))
            var district = spliceRep[5].substring(22,spliceRep[5].indexOf(',"f'))
            var fax = spliceRep[7].substring(0,spliceRep[7].indexOf('"'))
            var first_name = spliceRep[8].substring(0,spliceRep[8].indexOf('"'))
            var last_name = spliceRep[11].substring(0,spliceRep[11].indexOf('"'))
            var facebook = spliceRep[6].substring(0,spliceRep[6].indexOf('"'))
            var email = spliceRep[14].substring(0,spliceRep[14].indexOf('"'))
            var address = spliceRep[16].substring(0,spliceRep[16].indexOf('"'))
            var party = spliceRep[17].substring(0,spliceRep[17].indexOf('"'))
            var phone = spliceRep[18].substring(0,spliceRep[18].indexOf('"'))
            var state = spliceRep[20].substring(0,spliceRep[20].indexOf('"'))
            var term_start = spliceRep[22].substring(0,spliceRep[22].indexOf('"'))
            var term_end = spliceRep[21].substring(0,spliceRep[21].indexOf('"'))
            var twitter = spliceRep[25].substring(0,spliceRep[25].indexOf('"'))
            text += first_name + " " + last_name + "<br><br>"
            text += "Chamber: " + chamber + "<br><br>";
            text += "Website: " + website + "<br><br>"
            text += "District: " + district + "<br><br>"
            text += "Fax: " + fax + "<br><br>"
            text += "Facebook page: facebook.com/profile.php?id=" + facebook + "<br><br>"
            text += "Email: " + email + "<br><br>"
            text += "Office address: " + address + "<br><br>"
            text += "Party: " + party + "<br><br>"
            text += "Phone number: " + phone + "<br><br>"
            text += "State: " + state + "<br><br>"
            text += "Term start: " + term_start + "<br><br>"
            text += "Term end: " + term_end + "<br><br>"
            text += "Twitter account: " + twitter + "<br><br>"
            text += "<br><br>"
        }
        var rep = document.getElementById("representative");
        rep.innerHTML = text;
  }

	</script>

</body>
</html>